import com.robypomper.build.docker.DockerNetworkUtils

/**
 * Gradle configurations to manage docker artifacts for JOSP project.
 *
 * Summary:
 * - Docker's Services configs
 * - Runners Tasks
 *
 * This file configure and provide tasks to manage following dockers:
 * - dbms: the local database manager system used by other local jcp's
 *         microservice like the auth and the jcpAPIs.
 * - auth: the authentication microservice used by jcpAPIs to check clients
 *         credentials via OAuth2.
 */


// -------------------------
// Docker's Services configs
// -------------------------

dockerCompose {
    dbms {                                                                  // on localhost:8999
        useComposeFiles = ['src/dockers/dbms/docker/docker-compose.yml']
    }
    auth {                                                                  // on localhost:8998
        useComposeFiles = ['src/dockers/auth/docker/docker-compose.yml']
    }
}

// Add docker's network dependency
DockerNetworkUtils.setDockerNetworkDependency(project,dockerCompose.dbms,"jcp-dev")
DockerNetworkUtils.setDockerNetworkDependency(project,dockerCompose.auth,"jcp-dev")


// -------------
// Runners Tasks
// -------------

// DBMS

task dbms_Up {
    description = 'Runs...'
    group = 'JOSP runners jcp (dockers)'
    dependsOn dbmsComposeUp
}

task dbms_Down {
    description = 'Runs...'
    group = 'JOSP runners jcp (dockers)'
    dependsOn dbmsComposeDown
}

task dbms_Clean {
    description = 'Runs...'
    group = 'JOSP cleaners'
    //...delete evs/docker/dbms dir
}

// Auth

task auth_Up {
    description = 'Runs...'
    group = 'JOSP runners jcp (dockers)'
    dependsOn authComposeUp
}

task auth_Down {
    description = 'Runs...'
    group = 'JOSP runners jcp (dockers)'
    dependsOn authComposeDown
}

task auth_Clean {
    description = 'Runs...'
    group = 'JOSP cleaners'
    //...delete and recreate jcp_auth database in dbms
}
